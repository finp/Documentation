<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knative on an OpenShift cluster 4.0 :: Serverless</title>
    <link rel="canonical" href="https://example.org/docs/ocf/latest/assembly_knative-OCP-4x.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://example.org/docs">Serverless</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="ocf" data-version="latest">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">ocf</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Home</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="assembly_knative-minishift.html">minishift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">3.11</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">4</span>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">ocf</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">ocf</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">ocf</a></li>
    <li class="crumb"><a href="assembly_knative-OCP-4x.html">Knative on an OpenShift cluster 4.0</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/pwright/repos/Documentation/modules/ROOT/pages/assembly_knative-OCP-4x.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Knative on an OpenShift cluster 4.0</h1>
<div class="sect1">
<h2 id="knative-ocp-4x_{context}"><a class="anchor" href="#knative-ocp-4x_{context}"></a>Knative on an OpenShift 4.0 cluster</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The functionality introduced by Knative on an OpenShift cluster is preview only. Red Hat support is not provided, and this release should not be used in a production environment.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This Knative on OpenShift preview is only available by using the OpenShift 4.0 developer preview. You will require a Red Hat Developers login to try this. Visit <a href="https://try.openshift.com/">try.openshift.com</a> for getting started information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You will need cluster administrator privileges to install and use Knative on an OpenShift cluster.</p>
</div>
<div class="sect3">
<h4 id="_supported_platform_version"><a class="anchor" href="#_supported_platform_version"></a>Supported platform version</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong> Platform</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Supported versions</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.0 Developer Preview</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-knative-ocp-using-script-4x_{context}"><a class="anchor" href="#installing-knative-ocp-using-script-4x_{context}"></a>Installing Knative on an OpenShift cluster 4.0 using the script provided</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This Knative on OpenShift preview is only available by using the OpenShift 4.0 developer preview.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You will require a Red Hat Developers login to try this.</p>
</li>
<li>
<p>Using 4.0 clusters with Knative requires visiting <a href="https://try.openshift.com/">try.openshift.com</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Login to the cluster using your admin credentials.</p>
<div class="literalblock">
<div class="content">
<pre>`oc login &lt;admin-credentials&gt;`</pre>
</div>
</div>
</li>
<li>
<p>Clone the <code>knative-operators</code> repository.</p>
<div class="literalblock">
<div class="content">
<pre>`git clone https://github.com/openshift-cloud-functions/knative-operators`
`cd knative-operators/`
`git fetch --tags`
`git checkout openshift-v0.3.0`</pre>
</div>
</div>
</li>
<li>
<p>Navigate to the newly cloned repository and run the <code>install.sh</code> script.</p>
<div class="literalblock">
<div class="content">
<pre>`./etc/scripts/install.sh`</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The installation script takes 20-30 minutes to complete, depending on your system.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Once the script starts, you will see the following warning and prompt:</p>
<div class="literalblock">
<div class="content">
<pre>`WARNING: This script will attempt to install Istio, Knative, and OLM in your Kubernetes/OpenShift cluster.`</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`If targeting OpenShift, a recent version of 'oc' should be available in your PATH. Otherwise, 'kubectl' will be used.`</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`If using OpenShift 3.11 and your cluster isn't minishift, ensure \$KUBE_SSH_KEY and \$KUBE_SSH_USER are set`</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`Pass -q to disable this prompt`</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`Enter to continue or Ctrl-C to exit:`</pre>
</div>
</div>
</li>
<li>
<p>Press Enter to continue.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="'allowing-external-access-knative-services-OCP-4x_{context}"><a class="anchor" href="#'allowing-external-access-knative-services-OCP-4x_{context}"></a>Allowing external access to Knative services on OCP 4.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use a configured hostname to access Knative services on the OpenShift 4.0 cluster.</p>
</div>
<div class="sect2">
<h3 id="updating-knative-config-domain-OCP-4x_{context}"><a class="anchor" href="#updating-knative-config-domain-OCP-4x_{context}"></a>Updating Knative&#8217;s config-domain ConfigMap and replacing "example.com" with your domain&#8217;s suffix</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find your cluster&#8217;s domain suffix by using the following command:</p>
<div class="literalblock">
<div class="content">
<pre>`oc get ingresses.config.openshift.io cluster -o jsonpath="{.spec.domain}"`</pre>
</div>
</div>
</li>
<li>
<p>Edit Knative&#8217;s config-domain ConfigMap and replace "example.com" with &lt;YOUR CLUSTER SUFFIX&gt; by using the following command:</p>
<div class="literalblock">
<div class="content">
<pre>`oc edit configmap config-domain -n knative-serving`</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="creating-OCP-route-pointing-istio_{context}"><a class="anchor" href="#creating-OCP-route-pointing-istio_{context}"></a>Creating an OpenShift Route pointing to the istio-ingressgateway for each of your Knative Services</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a yaml file, "my-route.yaml" with the following contents:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Replace &lt;YOUR KNATIVE SERVICE NAME&gt; with your knative service name;</p>
</li>
<li>
<p>Replace &lt;YOUR NAMESPACE&gt; with your service&#8217;s namespace;</p>
</li>
<li>
<p>Replace &lt;YOUR CLUSTER SUFFIX&gt; with the value output by the <code>oc get</code> command in the previous step.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>    apiVersion: v1
    kind: Route
      metadata:
      name: &lt;YOUR KNATIVE SERVICE NAME&gt;
      namespace: istio-system
    spec:
      host: &lt;YOUR KNATIVE SERVICE NAME&gt;.&lt;YOUR NAMESPACE&gt;.&lt;YOUR CLUSTER SUFFIX&gt;
      to:
        kind: Service
        name: istio-ingressgateway</pre>
</div>
</div>
</li>
<li>
<p>Run the following yaml file command:</p>
<div class="literalblock">
<div class="content">
<pre>`oc apply -f my-route.yaml`</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you previously deployed Knative Services, you will need to redeploy them for the changes to the domain ConfgMap to take effect.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
